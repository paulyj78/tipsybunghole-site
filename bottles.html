<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Tipsy Bunghole â€“ Bottle Inventory</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Courier New', Courier, monospace;
      background-image: url('https://firebasestorage.googleapis.com/v0/b/tipsy-bunghole-photos.appspot.com/o/IMG_0037.jpeg?alt=media&token=857fc39c-1247-45df-9fc7-5836eddce8db');
      background-size: cover;
      background-repeat: repeat;
      background-attachment: fixed;
    }

    #bottleForm {
      background: #fff8a8;
      padding: 15px;
      width: 280px;
      margin: 20px auto;
      border-radius: 8px;
      box-shadow: 3px 3px 6px rgba(0,0,0,0.2);
      transform: rotate(-1deg);
      font-family: 'Courier New', monospace;
    }

    #bottleForm input[type="text"] {
      width: 100%;
      margin-bottom: 8px;
    }

    .sticky-note {
      padding: 10px;
      margin: 12px;
      width: 200px;
      min-height: 120px;
      border-radius: 6px;
      box-shadow: 4px 4px 10px rgba(0,0,0,0.3);
      display: inline-block;
      vertical-align: top;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      position: relative;
    }

    .sticky-yellow { background: #fff89e; }
    .sticky-blue   { background: #d0f0fd; }
    .sticky-pink   { background: #ffd1dc; }
    .sticky-green  { background: #d4fcb1; }

    .buttons {
      margin-top: 8px;
    }

    .buttons button {
      margin-right: 4px;
      font-size: 0.8em;
    }

    #bottleContainer {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 20px;
    }

    .return-btn {
      display: block;
      margin: 40px auto;
      background-color: #5e3c00;
      color: white;
      padding: 10px 20px;
      text-align: center;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      text-decoration: none;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    }

    .rare-icon {
      position: absolute;
      top: 5px;
      right: 10px;
      font-size: 20px;
    }
  </style>
</head>
<body>

  <details open id="formSection">
    <summary style="text-align: center; font-weight: bold; cursor: pointer;">âž• Add a New Bottle</summary>
    <form id="bottleForm">
      <input type="text" id="bottleName" placeholder="Bottle Name" required>
      <input type="text" id="distillery" placeholder="Distillery" required>
      <input type="text" id="notes" placeholder="Tasting Notes">
      <label><input type="checkbox" id="isRare"> Mark as Rare</label>
      <br><br>
      <button type="submit" style="background-color:#e67e22;color:white;padding:5px 10px;border:none;border-radius:5px;">Add Bottle</button>
    </form>
  </details>

  <div id="bottleContainer"></div>

  <a class="return-btn" href="index.html">Return to the Bunghole</a>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAxvLgYQOOxx8QIqVckgEdjHpDlYTzcwGs",
      authDomain: "tipsy-bunghole-guest-book.firebaseapp.com",
      projectId: "tipsy-bunghole-photos",
      storageBucket: "tipsy-bunghole-photos.appspot.com",
      messagingSenderId: "152050189848",
      appId: "1:152050189848:web:9ba719e8d2ad24c138e56d",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const bottleForm = document.getElementById('bottleForm');
    const bottleContainer = document.getElementById('bottleContainer');

    function getRandomNoteColor() {
      const colors = ['sticky-yellow', 'sticky-blue', 'sticky-pink', 'sticky-green'];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    function createBottleNote(doc) {
      const data = doc.data();
      const note = document.createElement('div');
      note.className = `sticky-note ${getRandomNoteColor()}`;
      note.setAttribute('data-id', doc.id);
      note.style.transform = `rotate(${Math.floor(Math.random() * 6 - 3)}deg)`;

      note.innerHTML = `
        ${data.rare ? '<div class="rare-icon">ðŸ¦„</div>' : ''}
        <strong>${data.name}</strong><br>
        <em>${data.distillery}</em><br>
        ${data.notes ? `<p>${data.notes}</p>` : ''}
        <div class="buttons">
          <button onclick="markAsKilled('${doc.id}')">Mark as Killed</button>
        </div>
      `;
      bottleContainer.appendChild(note);
    }

    function markAsKilled(id) {
      db.collection("bottles").doc(id).update({ killed: true });
    }

    function loadBottles() {
      bottleContainer.innerHTML = "";
      db.collection("bottles").where("killed", "==", false).get().then(snapshot => {
        snapshot.forEach(doc => createBottleNote(doc));
      });
    }

    bottleForm.addEventListener('submit', e => {
      e.preventDefault();
      db.collection("bottles").add({
        name: bottleForm.bottleName.value,
        distillery: bottleForm.distillery.value,
        notes: bottleForm.notes.value,
        rare: document.getElementById('isRare').checked,
        killed: false
      }).then(() => {
        bottleForm.reset();
        loadBottles();
      });
    });

    loadBottles();

    // Enable drag & drop
    new Sortable(bottleContainer, {
      animation: 150,
      ghostClass: 'sortable-ghost',
    });
  </script>

</body>
</html>
