<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Tipsy Bunghole Bottles</title>
  <style>
    body {
      font-family: 'Courier New', Courier, monospace;
      background: url('https://firebasestorage.googleapis.com/v0/b/tipsy-bunghole-photos.appspot.com/o/IMG_0037.jpeg?alt=media&token=857fc39c-1247-45df-9fc7-5836eddce8db') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
    }

    .bottle-form-container {
      background: rgba(255, 255, 240, 0.9);
      padding: 10px;
      margin: 10px;
      border: 2px dashed #aaa;
      border-radius: 8px;
    }

    .bottle-form {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .bottle-form input,
    .bottle-form select {
      padding: 6px;
      border: 1px solid #aaa;
      border-radius: 4px;
      font-family: inherit;
    }

    .bottle-form button {
      background: #523a28;
      color: white;
      border: none;
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
    }

    .bottle-form button:hover {
      background: #7e5c3d;
    }

    #bottleList {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
      padding: 20px;
      gap: 16px;
    }

    .bottle-row {
      width: 300px;
      display: flex;
      flex-direction: column;
      background: #fffef0;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.2);
      position: relative;
      transform: rotate(calc(-2deg + 4deg * var(--random-rotation)));
    }

    .bottle-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }

    .icon-stack {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      margin-top: 10px;
    }

    .favorite-toggle,
    .toggle-icon,
    .edit-icon {
      cursor: pointer;
      font-size: 20px;
      line-height: 1;
    }

    .favorite-toggle.inactive {
      color: #ccc;
    }

    .bottle-row.rare {
      border: 2px solid gold;
    }

    .bottle-row.killed {
      opacity: 0.5;
    }

    .bottle-row.favorite {
      background: #fff8e1;
    }

    .edit-icon {
      font-size: 16px;
      opacity: 0.7;
    }
  </style>
</head>
<body>

  <div class="bottle-form-container">
    <form class="bottle-form" onsubmit="addBottle(event)">
      <input type="text" id="name" placeholder="Bottle Name" required />
      <input type="text" id="distillery" placeholder="Distillery" />
      <input type="text" id="abv" placeholder="ABV" />
      <input type="text" id="age" placeholder="Age" />
      <input type="text" id="barcode" placeholder="Barcode" />
      <button type="submit">Add Bottle</button>
    </form>
  </div>

  <div id="bottleList"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAxvLgYQOOxx8QIqVckgEdjHpDlYTzcwGs",
      authDomain: "tipsy-bunghole-photos.firebaseapp.com",
      projectId: "tipsy-bunghole-photos",
      storageBucket: "tipsy-bunghole-photos.appspot.com",
      messagingSenderId: "319231226146",
      appId: "1:319231226146:web:3b389de842ed4c1483ec4e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function renderBottle(doc) {
      const data = doc.data();
      const bottleHTML = `
        <div class="bottle-row ${data.killed ? 'killed' : ''} ${data.unicorn ? 'rare' : ''} ${data.favorite ? 'favorite' : ''}" style="--random-rotation: ${Math.random()}">
          <div class="bottle-info">
            <strong>${data.name || ''}</strong>
            <span>${data.distillery || ''}</span>
            <span>${data.abv || ''} ABV</span>
            <span>${data.age || ''} yrs</span>
            <span>${data.barcode || ''}</span>
          </div>
          <div class="icon-stack">
            <span class="favorite-toggle ${data.favorite ? '' : 'inactive'}" onclick="toggleFavorite('${doc.id}', this)">‚òÖ</span>
            <span class="toggle-icon" title="Toggle Killed" onclick="toggleKilled('${doc.id}', ${!data.killed})">ü™¶</span>
            <span class="toggle-icon" title="Toggle Unicorn" onclick="toggleUnicorn('${doc.id}', ${!data.unicorn})">ü¶Ñ</span>
            <span class="edit-icon" onclick="editBottle('${doc.id}')">‚úèÔ∏è</span>
          </div>
        </div>
      `;
      document.getElementById('bottleList').insertAdjacentHTML('beforeend', bottleHTML);
    }

    function addBottle(e) {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const distillery = document.getElementById('distillery').value;
      const abv = document.getElementById('abv').value;
      const age = document.getElementById('age').value;
      const barcode = document.getElementById('barcode').value;
      db.collection("bottles").add({
        name, distillery, abv, age, barcode,
        killed: false,
        unicorn: false,
        favorite: false
      }).then(() => {
        e.target.reset();
        loadBottles();
      });
    }

    function toggleKilled(id, value) {
      db.collection("bottles").doc(id).update({ killed: value }).then(loadBottles);
    }

    function toggleUnicorn(id, value) {
      db.collection("bottles").doc(id).update({ unicorn: value }).then(loadBottles);
    }

    function toggleFavorite(id, el) {
      const newValue = el.classList.contains("inactive");
      db.collection("bottles").doc(id).update({ favorite: newValue }).then(loadBottles);
    }

    function editBottle(id) {
      const newName = prompt("Enter new name:");
      if (newName) {
        db.collection("bottles").doc(id).update({ name: newName }).then(loadBottles);
      }
    }

    function loadBottles() {
      document.getElementById("bottleList").innerHTML = "";
      db.collection("bottles").orderBy("name").get().then(snapshot => {
        snapshot.forEach(renderBottle);
      });
    }

    loadBottles();
  </script>

</body>
</html>
