<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1" />
 <title>The Tipsy Bunghole Bottles</title>
 <style>
   body {
     background-image: url('https://firebasestorage.googleapis.com/v0/b/tipsy-bunghole-photos.appspot.com/o/IMG_0037.jpeg?alt=media&token=857fc39c-1247-45df-9fc7-5836eddce8db');
     background-size: cover;
     font-family: 'Courier New', monospace;
     color: #000;
     padding: 20px;
   }

   h1 {
     font-size: 2em;
     margin-bottom: 20px;
   }

   #bottleForm {
     background: rgba(255, 255, 255, 0.1);
     border: 2px dashed #ffb347;
     padding: 10px;
     margin-bottom: 20px;
     border-radius: 10px;
   }

   .filter-container {
     margin-bottom: 20px;
   }

   .filter-container input,
   .filter-container select {
     margin-right: 10px;
     padding: 5px;
   }

   .bottle-row {
 display: flex;
 justify-content: space-between;
 align-items: center;
 background: #fffef0;
 color: #000;
 padding: 10px;
 margin: 8px 0;
 border-radius: 6px;
 border: 1px solid #ccc;
 box-shadow: 2px 2px 4px rgba(0,0,0,0.2);
 font-family: 'Courier New', monospace;
   }

   .bottle-row.killed {
     opacity: 0.4;
     text-decoration: line-through;
   }

 display: flex;
 justify-content: space-between;
 align-items: center;
 background: #fffef0;
 color: #000;
 padding: 10px;
 margin: 8px 0;
 border-radius: 6px;
 border: 1px solid #ccc;
 box-shadow: 2px 2px 4px rgba(0,0,0,0.2);
 font-family: 'Courier New', monospace;
}

.bottle-row.killed {
 opacity: 0.4;
 text-decoration: line-through;
}

.bottle-info {
 display: flex;
 gap: 20px;
 flex-wrap: wrap;
 flex: 1;
 min-width: 0;
 overflow-wrap: break-word;
}

.bottle-controls {
 display: flex;
 align-items: center;
 gap: 10px;
 flex-shrink: 0;
}

.favorite-toggle {
 font-size: 1.5em;
 cursor: pointer;
 color: gold;
 position: static
}

.favorite-toggle.inactive {
 color: #ccc;
}

.toggle-switch {
 cursor: pointer;
}

.edit-icon {
 cursor: pointer;
 font-size: 1em;
}

   }

   .drag-handle {
     cursor: grab;
     margin-right: 10px;
   }

   .favorite-toggle {
     font-size: 1.5em
     cursor: pointer;
     color: gold;


   }

   .favorite-toggle.inactive {
     color: #ccc;
   }

   .toggle-switch {
     cursor: pointer;
   }

   .edit-icon {
     margin-left: 10px;
     cursor: pointer;
     font-size: 14px;
   }

   button {
     background-color: #ffb347;
     border: none;
     padding: 8px 12px;
     border-radius: 4px;
     cursor: pointer;
     font-weight: bold;
   }
 </style>
</head>
<body>

 <h1>üì¶ The Tipsy Bunghole Bottle Inventory</h1>

 <div class="filter-container">
   <input type="text" id="searchBar" placeholder="Search..." />
   <select id="filterDistillery">
     <option value="">All Distilleries</option>
   </select>
   <select id="filterFavorite">
     <option value="">All</option>
     <option value="true">Favorites</option>
     <option value="false">Non-Favorites</option>
   </select>
   <select id="filterKilled">
     <option value="">All</option>
     <option value="true">Killed</option>
     <option value="false">Alive</option>
   </select>
   <select id="filterShelf">
     <option value="">All Shelves</option>
   </select>
 </div>

 <div id="bottleForm">
   <input type="text" id="nameInput" placeholder="Bottle Name">
   <input type="text" id="distilleryInput" placeholder="Distillery">
   <input type="text" id="proofInput" placeholder="Proof">
   <input type="text" id="shelfInput" placeholder="Shelf#">
   <button onclick="addBottle()">Add Bottle</button>
 </div>

 <div id="bottleList"></div>

 <!-- Firebase & Sortable -->
 <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

 <script>
   const firebaseConfig = {
     apiKey: "AIzaSyAxvLgYQOOxx8QIqVckgEdjHpDlYTzcwGs",
     authDomain: "tipsy-bunghole-photos.firebaseapp.com",
     projectId: "tipsy-bunghole-photos",
     storageBucket: "tipsy-bunghole-photos.appspot.com",
     messagingSenderId: "183586489596",
     appId: "1:183586489596:web:3f7dd0d0f9ae30c9e059f2"
   };
   firebase.initializeApp(firebaseConfig);
   const db = firebase.firestore();

   const bottleList = document.getElementById('bottleList');
   const distilleryFilter = document.getElementById('filterDistillery');
   const favoriteFilter = document.getElementById('filterFavorite');
   const killedFilter = document.getElementById('filterKilled');
   const shelfFilter = document.getElementById('filterShelf');
   const searchBar = document.getElementById('searchBar');

   function renderBottle(doc) {
     const data = doc.data();
     const div = document.createElement('div');
     div.className = 'bottle-row';
     if (data.killed) div.classList.add('killed');
     div.setAttribute('data-id', doc.id);
     div.setAttribute('data-name', (data.name || '').toLowerCase());
     div.setAttribute('data-distillery', (data.distillery || '').toLowerCase());
     div.setAttribute('data-favorite', data.favorite || false);
     div.setAttribute('data-killed', data.killed || false);
     div.setAttribute('data-shelf', (data.shelf || '').toLowerCase());

div.innerHTML = `
       <span class="drag-handle">‚ò∞</span>
       <div class="bottle-info">
         <span>${data.name}</span>
         <span>Distillery: ${data.distillery}</span>
         <span>Proof: ${data.proof}</span>
         <span>Shelf: ${data.shelf || 'N/A'}</span>
       </div>
       <span class="favorite-toggle ${data.favorite ? '' : 'inactive'}" onclick="toggleFavorite('${doc.id}', this)">‚òÖ</span>
       <label class="toggle-switch">
         <input type="checkbox" onchange="toggleKilled('${doc.id}', this.checked)" ${data.killed ? 'checked' : ''}>
         ü™¶
       </label>
       <span class="edit-icon" onclick="editBottle('${doc.id}')">‚úèÔ∏è</span>
     `;
     bottleList.appendChild(div)
     ;
   }

   function fetchAndRender() {
     bottleList.innerHTML = '';
     const distillerySet = new Set();
     const shelfSet = new Set();

     db.collection('bottles').orderBy('order').get().then(snapshot => {
       snapshot.forEach(doc => {
         const data = doc.data();
         if (data.distillery) distillerySet.add(data.distillery);
         if (data.shelf) shelfSet.add(data.shelf);
         renderBottle(doc);
       });
       populateFilters(distillerySet, shelfSet);
       applyFilters();
     });
   }

   function populateFilters(distilleries, shelves) {
     distilleryFilter.innerHTML = `<option value="">All Distilleries</option>`;
     Array.from(distilleries).sort().forEach(d => {
       distilleryFilter.innerHTML += `<option value="${d}">${d}</option>`;
     });

     shelfFilter.innerHTML = `<option value="">All Shelves</option>`;
     Array.from(shelves).sort().forEach(s => {
       shelfFilter.innerHTML += `<option value="${s}">${s}</option>`;
     });
   }

   function addBottle() {
     const name = document.getElementById('nameInput').value.trim();
     const distillery = document.getElementById('distilleryInput').value.trim();
     const proof = document.getElementById('proofInput').value.trim();
     const shelf = document.getElementById('shelfInput').value.trim();

     if (!name || !distillery) return;

     db.collection('bottles').add({
       name, distillery, proof, shelf,
       killed: false,
       favorite: false,
       order: Date.now()
     }).then(() => {
       document.getElementById('nameInput').value = '';
       document.getElementById('distilleryInput').value = '';
       document.getElementById('proofInput').value = '';
       document.getElementById('shelfInput').value = '';
       fetchAndRender();
     });
   }

   function toggleKilled(id, state) {
     db.collection('bottles').doc(id).update({ killed: state }).then(fetchAndRender);
   }

   function toggleFavorite(id, el) {
     const isActive = !el.classList.contains('inactive');
     db.collection('bottles').doc(id).update({ favorite: !isActive }).then(() => {
       el.classList.toggle('inactive', isActive);
       el.parentElement.setAttribute('data-favorite', String(!isActive));
       applyFilters();
     });
   }

   function editBottle(id) {
     alert("Editing not yet implemented.");
   }

   new Sortable(bottleList, {
     handle: '.drag-handle',
     animation: 150,
     onEnd: () => {
       [...bottleList.children].forEach((el, index) => {
         db.collection('bottles').doc(el.dataset.id).update({ order: index });
       });
     }
   });

   [searchBar, distilleryFilter, favoriteFilter, killedFilter, shelfFilter].forEach(el => {
     el.addEventListener('input', applyFilters);
   });

   function applyFilters() {
     const search = searchBar.value.toLowerCase();
     const dist = distilleryFilter.value.toLowerCase();
     const fav = favoriteFilter.value;
     const kill = killedFilter.value;
     const shelf = shelfFilter.value.toLowerCase();

     [...bottleList.children].forEach(row => {
       const name = row.dataset.name;
       const distillery = row.dataset.distillery;
       const favorite = row.dataset.favorite === 'true';
       const killed = row.dataset.killed === 'true';
       const shelfNum = row.dataset.shelf;

       let show = true;
       if (search && !name.includes(search) && !distillery.includes(search)) show = false;
       if (dist && distillery !== dist) show = false;
       if (fav && String(favorite) !== fav) show = false;
       if (kill && String(killed) !== kill) show = false;
       if (shelf && shelfNum !== shelf) show = false;

       row.style.display = show ? 'flex' : 'none';
     });
   }

   fetchAndRender();
 </script>
</body>
</html>
